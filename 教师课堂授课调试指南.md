# 教师课堂授课页面调试指南

## 问题描述

详情页无法点击"📝 生成教案"按钮

## 调试步骤

### 1. 打开浏览器开发者工具

- **Chrome/Edge**: 按 `F12` 或 `Ctrl+Shift+I`
- **Firefox**: 按 `F12`
- **Safari**: `Cmd+Option+I` (Mac)

### 2. 切换到 Console 标签

查看是否有JavaScript错误信息

### 3. 测试按钮功能

#### 步骤A: 打开页面
1. 打开 `teacher-classroom.html`
2. 等待数据加载完成（看到"✅ 数据加载完成"提示）

#### 步骤B: 选择章节
1. 从左侧点击任意章节
2. 查看右侧是否显示知识点卡片

#### 步骤C: 查看详情
1. 点击任意知识点卡片的"📖 查看详情"按钮
2. 在Console中查看是否有以下输出：
   ```
   === showNodeDetail called ===
   nodeId: node-xxx
   found node: {id: "node-xxx", name: "...", ...}
   ```

#### 步骤D: 生成教案
1. 在详情页面，点击"📝 生成教案"按钮
2. 在Console中查看是否有以下输出：
   ```
   === generateLessonPlan called ===
   nodeId: node-xxx
   allNodes: Array(172)
   found node: {id: "node-xxx", name: "...", ...}
   ```

### 4. 常见问题排查

#### 问题1: 按钮没有反应

**可能原因**:
- JavaScript加载失败
- 函数未定义
- 节点ID不正确

**解决方法**:
1. 在Console中输入以下命令测试：
   ```javascript
   typeof window.generateLessonPlan
   ```
   应该返回 `"function"`

2. 如果返回 `"undefined"`，说明函数未加载，刷新页面重试

#### 问题2: 点击后报错

**可能原因**:
- 节点数据未加载
- 节点ID不存在

**解决方法**:
1. 在Console中检查：
   ```javascript
   allNodes
   ```
   应该显示一个包含172个节点的数组

2. 检查节点ID是否正确：
   ```javascript
   allNodes.find(n => n.id === '你的节点ID')
   ```

#### 问题3: 按钮被遮挡

**可能原因**:
- CSS样式问题
- z-index层级问题

**解决方法**:
1. 在Elements标签中检查按钮元素
2. 查看是否有其他元素覆盖在按钮上方
3. 尝试调整浏览器窗口大小

### 5. 手动测试函数

在Console中直接调用函数测试：

```javascript
// 测试查看详情
window.showNodeDetail('node-d1-1')

// 测试生成教案
window.generateLessonPlan('node-d1-1')

// 测试导出教案
window.exportLessonPlan('node-d1-1')
```

### 6. 检查数据加载

```javascript
// 检查节点数据
console.log('节点总数:', allNodes.length)

// 检查学域数据
console.log('学域数据:', domainMap)

// 检查当前章节
console.log('当前章节:', currentChapter)
```

## 已添加的调试功能

### Console日志

页面已添加详细的Console日志输出：

1. **数据加载**:
   - `✅ 数据加载完成` - 数据加载成功
   - `❌ 数据加载失败` - 数据加载失败

2. **查看详情**:
   - `=== showNodeDetail called ===` - 函数被调用
   - `nodeId: xxx` - 节点ID
   - `found node: {...}` - 找到的节点数据

3. **生成教案**:
   - `=== generateLessonPlan called ===` - 函数被调用
   - `nodeId: xxx` - 节点ID
   - `allNodes: Array(172)` - 所有节点
   - `found node: {...}` - 找到的节点数据

4. **错误信息**:
   - `Node not found!` - 节点未找到
   - `❌ 节点未找到` - Toast提示

### Toast通知

页面会显示操作提示：
- `✅ 数据加载完成`
- `✅ 教案生成成功`
- `✅ 教案已导出为 Markdown 文件`
- `❌ 节点未找到`

## 测试文件

### test-classroom-buttons.html

创建了一个简化的测试页面，用于测试按钮点击功能：

```bash
# 在浏览器中打开
test-classroom-buttons.html
```

这个测试页面会：
1. 显示测试按钮
2. 测试onclick事件
3. 在Console中输出调试信息

## 解决方案

### 方案1: 清除缓存

1. 按 `Ctrl+Shift+Delete` 打开清除浏览器数据
2. 选择"缓存的图片和文件"
3. 点击"清除数据"
4. 刷新页面 (`Ctrl+F5`)

### 方案2: 使用无痕模式

1. 按 `Ctrl+Shift+N` (Chrome) 或 `Ctrl+Shift+P` (Firefox)
2. 在无痕窗口中打开页面
3. 测试功能是否正常

### 方案3: 检查文件路径

确保以下文件存在：
- `data/nodes.json` - 节点数据
- `data/domains.json` - 学域数据
- `js/modules/NodeDataManager.js` - 数据管理模块

### 方案4: 使用本地服务器

不要直接双击HTML文件打开，而是使用本地服务器：

```bash
# 使用Python
python -m http.server 8000

# 使用Node.js
npx http-server

# 使用PHP
php -S localhost:8000
```

然后访问: `http://localhost:8000/teacher-classroom.html`

## 常见错误信息

### CORS错误

```
Access to fetch at 'file:///...' from origin 'null' has been blocked by CORS policy
```

**解决方法**: 使用本地服务器（见方案4）

### 模块加载错误

```
Failed to load module script: Expected a JavaScript module script
```

**解决方法**: 
1. 检查文件路径是否正确
2. 使用本地服务器运行

### 节点未找到

```
Node not found!
```

**解决方法**:
1. 检查节点ID是否正确
2. 确认数据已加载完成
3. 查看Console中的allNodes数组

## 联系支持

如果以上方法都无法解决问题，请：

1. 截图Console中的错误信息
2. 记录操作步骤
3. 联系技术支持：15805295231

---

**更新时间**: 2026-03-01  
**版本**: 1.0.0
