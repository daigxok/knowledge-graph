<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•™å¸ˆè¯¾å ‚æˆè¯¾ | é«˜ç­‰æ•°å­¦å­¦åŸŸçŸ¥è¯†å›¾è°±</title>
    
    <!-- MathJax for LaTeX rendering -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 16px;
            padding: 24px 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .header h1 {
            font-size: 28px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .sidebar {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .sidebar h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .quick-search {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
            transition: border-color 0.3s;
        }
        
        .quick-search:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .chapter-list {
            list-style: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .chapter-item {
            padding: 12px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .chapter-item:hover {
            background: #e9ecef;
            border-left-color: #667eea;
            transform: translateX(4px);
        }
        
        .chapter-item.active {
            background: #e7eaff;
            border-left-color: #667eea;
        }
        
        .chapter-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }
        
        .chapter-count {
            font-size: 12px;
            color: #666;
        }
        
        .content-area {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            min-height: 600px;
        }
        
        .welcome-screen {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .welcome-screen h2 {
            font-size: 32px;
            margin-bottom: 16px;
            color: #667eea;
        }
        
        .welcome-screen p {
            font-size: 16px;
            line-height: 1.6;
        }
        
        .node-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }
        
        .node-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .node-card:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.2);
        }
        
        .node-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }
        
        .node-name {
            font-weight: 600;
            font-size: 16px;
            color: #333;
            flex: 1;
        }
        
        .node-difficulty {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .node-description {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .node-domains {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }
        
        .domain-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .domain-1 { background: #e7eaff; color: #667eea; }
        .domain-2 { background: #ffe7f7; color: #f093fb; }
        .domain-3 { background: #e7f7ff; color: #4facfe; }
        .domain-4 { background: #ffe7f0; color: #fa709a; }
        .domain-5 { background: #e7ffff; color: #00f2fe; }
        
        .node-actions {
            display: flex;
            gap: 8px;
        }
        
        .node-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .node-btn-primary {
            background: #667eea;
            color: white;
        }
        
        .node-btn-primary:hover {
            background: #5568d3;
        }
        
        .node-btn-secondary {
            background: #e9ecef;
            color: #333;
        }
        
        .node-btn-secondary:hover {
            background: #dee2e6;
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #667eea;
        }
        
        .detail-title-section h2 {
            font-size: 28px;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .detail-subtitle {
            font-size: 14px;
            color: #666;
        }
        
        .back-to-list {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-to-list:hover {
            background: #e0e0e0;
        }
        
        .detail-section {
            margin-bottom: 28px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
        }
        
        .detail-section h3 {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-section p, .detail-section ul {
            font-size: 14px;
            color: #333;
            line-height: 1.8;
        }
        
        .detail-section ul {
            padding-left: 24px;
        }
        
        .detail-section ul li {
            margin-bottom: 8px;
        }
        
        .formula-box {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            margin: 12px 0;
            overflow-x: auto;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #333;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 2000;
            display: none;
            animation: slideIn 0.3s;
        }
        
        .toast.show {
            display: block;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .detail-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
            padding-top: 24px;
            border-top: 2px solid #e0e0e0;
        }
        
        .action-btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .action-btn-primary {
            background: #667eea;
            color: white;
        }
        
        .action-btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .action-btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .action-btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .lesson-plan-content {
            background: #f8f9fa;
            padding: 24px;
            border-radius: 12px;
            margin-top: 16px;
        }
        
        .lesson-plan-section {
            margin-bottom: 24px;
        }
        
        .lesson-plan-section:last-child {
            margin-bottom: 0;
        }
        
        .lesson-plan-section h4 {
            color: #667eea;
            font-size: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .lesson-plan-section p, .lesson-plan-section ul {
            font-size: 14px;
            color: #333;
            line-height: 1.8;
        }
        
        .lesson-plan-section ul {
            padding-left: 24px;
        }
        
        .lesson-plan-section li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ‘¨â€ğŸ« æ•™å¸ˆè¯¾å ‚æˆè¯¾</h1>
            <div class="header-actions">
                <a href="teacher-prep.html" class="btn btn-secondary">ğŸ“‹ å¤‡è¯¾ä¸­å¿ƒ</a>
                <a href="index.html" class="btn btn-secondary">ğŸ“Š çŸ¥è¯†å›¾è°±</a>
                <button class="btn btn-primary" id="btnFullscreen">ğŸ–¥ï¸ å…¨å±æ¨¡å¼</button>
            </div>
        </div>
        
        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Sidebar -->
            <div class="sidebar">
                <h2>ğŸ“š å¿«é€Ÿå¯¼èˆª</h2>
                <input 
                    type="text" 
                    class="quick-search" 
                    id="quickSearch" 
                    placeholder="æœç´¢çŸ¥è¯†ç‚¹..."
                />
                <ul class="chapter-list" id="chapterList">
                    <li class="loading">
                        <div class="spinner"></div>
                        <p>åŠ è½½ä¸­...</p>
                    </li>
                </ul>
            </div>
            
            <!-- Content Area -->
            <div class="content-area" id="contentArea">
                <div class="welcome-screen">
                    <h2>ğŸ‘‹ æ¬¢è¿ä½¿ç”¨è¯¾å ‚æˆè¯¾æ¨¡å¼</h2>
                    <p style="font-size: 16px; margin-bottom: 20px;">
                        <strong>ä¸‰æ­¥å¿«é€Ÿå¼€å§‹ï¼š</strong>
                    </p>
                    <div style="text-align: left; max-width: 600px; margin: 0 auto;">
                        <p style="margin-bottom: 12px;">
                            <strong>1ï¸âƒ£ é€‰æ‹©ç« èŠ‚</strong> - ä»å·¦ä¾§ç« èŠ‚åˆ—è¡¨ç‚¹å‡»è¦è®²æˆçš„ç« èŠ‚
                        </p>
                        <p style="margin-bottom: 12px;">
                            <strong>2ï¸âƒ£ æŸ¥çœ‹çŸ¥è¯†ç‚¹</strong> - ç‚¹å‡»çŸ¥è¯†ç‚¹å¡ç‰‡çš„"ğŸ“– æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®ï¼ŒæŸ¥çœ‹å®Œæ•´ä¿¡æ¯
                        </p>
                        <p style="margin-bottom: 12px;">
                            <strong>3ï¸âƒ£ ç”Ÿæˆæ•™æ¡ˆ</strong> - åœ¨è¯¦æƒ…å¼¹çª—ä¸­ç‚¹å‡»"ğŸ“ ç”Ÿæˆæ•™æ¡ˆ"æŒ‰é’®ï¼Œè‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–æ•™æ¡ˆ
                        </p>
                    </div>
                    <p style="margin-top: 24px; font-size: 14px; color: #999;">
                        ğŸ’¡ æç¤ºï¼šç‚¹å‡»"ğŸ–¥ï¸ å±•ç¤º"æŒ‰é’®å¯è¿›å…¥å…¨å±æ¼”ç¤ºæ¨¡å¼ï¼Œé€‚åˆè¯¾å ‚æŠ•å½±
                    </p>
                    <p style="margin-top: 12px; font-size: 14px; color: #999;">
                        ğŸ” å¿«é€ŸæŸ¥æ‰¾ï¼šä½¿ç”¨å·¦ä¾§æœç´¢æ¡†å¯å¿«é€Ÿå®šä½ä»»æ„çŸ¥è¯†ç‚¹
                    </p>
                </div>
            </div>
        </div>
    </div>
    

    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <script type="module">
        // Import modules
        import { nodeDataManager } from './js/modules/NodeDataManager.js';
        
        // State
        let allNodes = [];
        let currentChapter = null;
        let domainMap = {};
        
        // Initialize
        async function init() {
            try {
                // Load nodes
                await nodeDataManager.loadNodes();
                allNodes = nodeDataManager.getAllNodes();
                
                // Load domains
                await loadDomains();
                
                // Render chapter list
                renderChapterList();
                
                // Bind events
                bindEvents();
                
                showToast('âœ… æ•°æ®åŠ è½½å®Œæˆ');
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                showToast('âŒ æ•°æ®åŠ è½½å¤±è´¥');
            }
        }
        
        // Load domains
        async function loadDomains() {
            try {
                const response = await fetch('data/domains.json');
                const domains = await response.json();
                domains.forEach(d => {
                    domainMap[d.id] = d;
                });
            } catch (error) {
                console.error('åŠ è½½å­¦åŸŸå¤±è´¥:', error);
            }
        }
        
        // Render chapter list
        function renderChapterList() {
            const chapterList = document.getElementById('chapterList');
            
            // Group nodes by chapter
            const chapterGroups = {};
            allNodes.forEach(node => {
                const chapter = node.chapter || 'å…¶ä»–';
                if (!chapterGroups[chapter]) {
                    chapterGroups[chapter] = [];
                }
                chapterGroups[chapter].push(node);
            });
            
            // Sort chapters
            const sortedChapters = Object.keys(chapterGroups).sort((a, b) => {
                if (a === 'å…¶ä»–') return 1;
                if (b === 'å…¶ä»–') return -1;
                return a.localeCompare(b, 'zh-CN');
            });
            
            // Render
            chapterList.innerHTML = sortedChapters.map(chapter => `
                <li class="chapter-item" data-chapter="${chapter}">
                    <div class="chapter-name">${chapter}</div>
                    <div class="chapter-count">${chapterGroups[chapter].length} ä¸ªçŸ¥è¯†ç‚¹</div>
                </li>
            `).join('');
        }
        
        // Render nodes for chapter
        function renderNodesForChapter(chapter) {
            currentChapter = chapter;
            const contentArea = document.getElementById('contentArea');
            
            // Get nodes for this chapter
            const nodes = allNodes.filter(n => (n.chapter || 'å…¶ä»–') === chapter);
            
            // Render
            contentArea.innerHTML = `
                <h2 style="margin-bottom: 24px; color: #667eea;">${chapter}</h2>
                <div class="node-grid">
                    ${nodes.map(node => renderNodeCard(node)).join('')}
                </div>
            `;
            
            // Update active chapter
            document.querySelectorAll('.chapter-item').forEach(item => {
                item.classList.toggle('active', item.dataset.chapter === chapter);
            });
        }
        
        // Render node card
        function renderNodeCard(node) {
            const domains = (node.domains || []).map(d => {
                const domain = domainMap[d];
                return domain ? `<span class="domain-badge ${d}">${domain.name}</span>` : '';
            }).join('');
            
            return `
                <div class="node-card" data-node-id="${node.id}">
                    <div class="node-card-header">
                        <div class="node-name">${node.name}</div>
                        <div class="node-difficulty">éš¾åº¦ ${node.difficulty || 3}</div>
                    </div>
                    <div class="node-description">${node.description || 'æš‚æ— æè¿°'}</div>
                    <div class="node-domains">${domains}</div>
                    <div class="node-actions">
                        <button class="node-btn node-btn-primary" onclick="window.showNodeDetail('${node.id}')">
                            ğŸ“– æŸ¥çœ‹è¯¦æƒ…
                        </button>
                        <button class="node-btn node-btn-secondary" onclick="window.presentNode('${node.id}')">
                            ğŸ–¥ï¸ å±•ç¤º
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Show node detail
        window.showNodeDetail = function(nodeId) {
            console.log('=== showNodeDetail called ===');
            console.log('nodeId:', nodeId);
            
            const node = allNodes.find(n => n.id === nodeId);
            console.log('found node:', node);
            
            if (!node) {
                console.error('Node not found!');
                showToast('âŒ èŠ‚ç‚¹æœªæ‰¾åˆ°');
                return;
            }
            
            const contentArea = document.getElementById('contentArea');
            
            // Get prerequisites
            const prerequisites = (node.prerequisites || [])
                .map(id => {
                    const prereq = allNodes.find(n => n.id === id);
                    return prereq ? prereq.name : id;
                })
                .join('ã€') || 'æ— ';
            
            // Get domains
            const domains = (node.domains || [])
                .map(d => domainMap[d]?.name || d)
                .join('ã€') || 'æ— ';
            
            contentArea.innerHTML = `
                <div class="detail-header">
                    <div class="detail-title-section">
                        <h2>${node.name}</h2>
                        <p class="detail-subtitle">${node.nameEn || ''}</p>
                    </div>
                    <button class="back-to-list" onclick="window.backToChapter()">
                        â† è¿”å›åˆ—è¡¨
                    </button>
                </div>
                
                <div class="detail-section">
                    <h3>ğŸ“ çŸ¥è¯†ç‚¹æè¿°</h3>
                    <p>${node.description || 'æš‚æ— æè¿°'}</p>
                </div>
                
                ${node.formula ? `
                <div class="detail-section">
                    <h3>ğŸ“ æ ¸å¿ƒå…¬å¼</h3>
                    <div class="formula-box">
                        $${node.formula}$
                    </div>
                </div>
                ` : ''}
                
                <div class="detail-section">
                    <h3>ğŸ¯ æ‰€å±å­¦åŸŸ</h3>
                    <p>${domains}</p>
                </div>
                
                <div class="detail-section">
                    <h3>ğŸ“š å‰ç½®çŸ¥è¯†</h3>
                    <p>${prerequisites}</p>
                </div>
                
                <div class="detail-section">
                    <h3>âš™ï¸ å­¦ä¹ å‚æ•°</h3>
                    <p>
                        éš¾åº¦ï¼š${node.difficulty || 3}/5 | 
                        é‡è¦æ€§ï¼š${node.importance || 3}/5 | 
                        é¢„è®¡å­¦ä¹ æ—¶é—´ï¼š${node.estimatedStudyTime || '2å°æ—¶'}
                    </p>
                </div>
                
                ${node.keywords && node.keywords.length > 0 ? `
                <div class="detail-section">
                    <h3>ğŸ·ï¸ å…³é”®è¯</h3>
                    <p>${node.keywords.join('ã€')}</p>
                </div>
                ` : ''}
                
                <div class="detail-actions">
                    <button class="action-btn action-btn-primary" onclick="window.generateLessonPlan('${node.id}')">
                        ğŸ“ ç”Ÿæˆæ•™æ¡ˆ
                    </button>
                    <button class="action-btn action-btn-secondary" onclick="window.presentNode('${node.id}')">
                        ğŸ–¥ï¸ å…¨å±å±•ç¤º
                    </button>
                </div>
            `;
            
            // Scroll to top
            contentArea.scrollTop = 0;
            
            // Render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([contentArea]).catch(err => console.error('MathJaxæ¸²æŸ“å¤±è´¥:', err));
            }
        };
        
        // Back to chapter list
        window.backToChapter = function() {
            if (currentChapter) {
                renderNodesForChapter(currentChapter);
            } else {
                const contentArea = document.getElementById('contentArea');
                contentArea.innerHTML = `
                    <div class="welcome-screen">
                        <h2>ğŸ‘‹ æ¬¢è¿ä½¿ç”¨è¯¾å ‚æˆè¯¾æ¨¡å¼</h2>
                        <p style="font-size: 16px; margin-bottom: 20px;">
                            <strong>ä¸‰æ­¥å¿«é€Ÿå¼€å§‹ï¼š</strong>
                        </p>
                        <div style="text-align: left; max-width: 600px; margin: 0 auto;">
                            <p style="margin-bottom: 12px;">
                                <strong>1ï¸âƒ£ é€‰æ‹©ç« èŠ‚</strong> - ä»å·¦ä¾§ç« èŠ‚åˆ—è¡¨ç‚¹å‡»è¦è®²æˆçš„ç« èŠ‚
                            </p>
                            <p style="margin-bottom: 12px;">
                                <strong>2ï¸âƒ£ æŸ¥çœ‹çŸ¥è¯†ç‚¹</strong> - ç‚¹å‡»çŸ¥è¯†ç‚¹å¡ç‰‡çš„"ğŸ“– æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®ï¼ŒæŸ¥çœ‹å®Œæ•´ä¿¡æ¯
                            </p>
                            <p style="margin-bottom: 12px;">
                                <strong>3ï¸âƒ£ ç”Ÿæˆæ•™æ¡ˆ</strong> - åœ¨è¯¦æƒ…é¡µé¢ä¸­ç‚¹å‡»"ğŸ“ ç”Ÿæˆæ•™æ¡ˆ"æŒ‰é’®ï¼Œè‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–æ•™æ¡ˆ
                            </p>
                        </div>
                        <p style="margin-top: 24px; font-size: 14px; color: #999;">
                            ğŸ’¡ æç¤ºï¼šç‚¹å‡»"ğŸ–¥ï¸ å±•ç¤º"æŒ‰é’®å¯è¿›å…¥å…¨å±æ¼”ç¤ºæ¨¡å¼ï¼Œé€‚åˆè¯¾å ‚æŠ•å½±
                        </p>
                        <p style="margin-top: 12px; font-size: 14px; color: #999;">
                            ğŸ” å¿«é€ŸæŸ¥æ‰¾ï¼šä½¿ç”¨å·¦ä¾§æœç´¢æ¡†å¯å¿«é€Ÿå®šä½ä»»æ„çŸ¥è¯†ç‚¹
                        </p>
                    </div>
                `;
            }
        };
        
        // Generate lesson plan
        window.generateLessonPlan = function(nodeId) {
            console.log('=== generateLessonPlan called ===');
            console.log('nodeId:', nodeId);
            console.log('allNodes:', allNodes);
            
            const node = allNodes.find(n => n.id === nodeId);
            console.log('found node:', node);
            
            if (!node) {
                console.error('Node not found!');
                showToast('âŒ èŠ‚ç‚¹æœªæ‰¾åˆ°');
                return;
            }
            
            const contentArea = document.getElementById('contentArea');
            
            // Get prerequisites
            const prerequisites = (node.prerequisites || [])
                .map(id => {
                    const prereq = allNodes.find(n => n.id === id);
                    return prereq ? prereq.name : id;
                });
            
            // Get domains
            const domains = (node.domains || [])
                .map(d => domainMap[d]?.name || d);
            
            // Generate lesson plan
            const lessonPlan = generateLessonPlanContent(node, prerequisites, domains);
            
            contentArea.innerHTML = `
                <div class="detail-header">
                    <div class="detail-title-section">
                        <h2>ğŸ“ æ•™æ¡ˆï¼š${node.name}</h2>
                        <p class="detail-subtitle">è‡ªåŠ¨ç”Ÿæˆçš„ç»“æ„åŒ–æ•™æ¡ˆ</p>
                    </div>
                    <button class="back-to-list" onclick="window.showNodeDetail('${node.id}')">
                        â† è¿”å›è¯¦æƒ…
                    </button>
                </div>
                
                <div class="lesson-plan-content">
                    ${lessonPlan}
                </div>
                
                <div class="detail-actions">
                    <button class="action-btn action-btn-primary" onclick="window.exportLessonPlan('${node.id}')">
                        ğŸ’¾ å¯¼å‡ºæ•™æ¡ˆ
                    </button>
                    <button class="action-btn action-btn-secondary" onclick="window.showNodeDetail('${node.id}')">
                        â† è¿”å›è¯¦æƒ…
                    </button>
                </div>
            `;
            
            // Scroll to top
            contentArea.scrollTop = 0;
            
            // Render MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([contentArea]).catch(err => console.error('MathJaxæ¸²æŸ“å¤±è´¥:', err));
            }
            
            showToast('âœ… æ•™æ¡ˆç”ŸæˆæˆåŠŸ');
        };
        
        // Generate lesson plan content
        function generateLessonPlanContent(node, prerequisites, domains) {
            const sections = [];
            
            // 1. æ•™å­¦ç›®æ ‡
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>ä¸€ã€æ•™å­¦ç›®æ ‡</h4>
                    <p>é€šè¿‡æœ¬èŠ‚è¯¾çš„å­¦ä¹ ï¼Œå­¦ç”Ÿåº”èƒ½å¤Ÿï¼š</p>
                    <ul>
                        <li>ç†è§£å¹¶æŒæ¡"${node.name}"çš„åŸºæœ¬æ¦‚å¿µå’Œå®šä¹‰</li>
                        <li>èƒ½å¤Ÿè¿ç”¨ç›¸å…³çŸ¥è¯†è§£å†³å®é™…é—®é¢˜</li>
                        <li>å»ºç«‹ä¸å…¶ä»–çŸ¥è¯†ç‚¹çš„è”ç³»ï¼Œå½¢æˆç³»ç»ŸåŒ–ç†è§£</li>
                        <li>åŸ¹å…»æ•°å­¦æ€ç»´å’Œé—®é¢˜è§£å†³èƒ½åŠ›</li>
                    </ul>
                    <p><strong>éš¾åº¦ç­‰çº§ï¼š</strong>${node.difficulty || 3}/5 | <strong>é‡è¦æ€§ï¼š</strong>${node.importance || 3}/5</p>
                </div>
            `);
            
            // 2. çŸ¥è¯†ç‚¹æ¦‚è¿°
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>äºŒã€çŸ¥è¯†ç‚¹æ¦‚è¿°</h4>
                    <p>${node.description || 'æš‚æ— æè¿°'}</p>
                    <p><strong>æ‰€å±å­¦åŸŸï¼š</strong>${domains.join('ã€') || 'æ— '}</p>
                    ${node.keywords && node.keywords.length > 0 ? `<p><strong>å…³é”®è¯ï¼š</strong>${node.keywords.join('ã€')}</p>` : ''}
                </div>
            `);
            
            // 3. å‰ç½®çŸ¥è¯†
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>ä¸‰ã€å‰ç½®çŸ¥è¯†</h4>
                    ${prerequisites.length > 0 ? `
                        <p>å­¦ä¹ æœ¬çŸ¥è¯†ç‚¹å‰ï¼Œå­¦ç”Ÿåº”è¯¥å·²ç»æŒæ¡ä»¥ä¸‹å†…å®¹ï¼š</p>
                        <ul>
                            ${prerequisites.map(name => `<li>${name}</li>`).join('')}
                        </ul>
                        <p>å»ºè®®åœ¨å­¦ä¹ æœ¬èŠ‚å†…å®¹å‰ï¼Œå…ˆå¤ä¹ ä¸Šè¿°å‰ç½®çŸ¥è¯†ã€‚</p>
                    ` : '<p>æœ¬çŸ¥è¯†ç‚¹æ— ç‰¹å®šå‰ç½®è¦æ±‚ï¼Œé€‚åˆåˆå­¦è€…å­¦ä¹ ã€‚</p>'}
                </div>
            `);
            
            // 4. æ ¸å¿ƒå†…å®¹
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>å››ã€æ ¸å¿ƒå†…å®¹</h4>
                    <p>${node.description || 'æš‚æ— æè¿°'}</p>
                    ${node.formula ? `
                        <p><strong>æ ¸å¿ƒå…¬å¼ï¼š</strong></p>
                        <div class="formula-box" style="margin: 12px 0;">
                            $${node.formula}$
                        </div>
                    ` : ''}
                    <p><strong>æ•™å­¦å»ºè®®ï¼š</strong></p>
                    <ul>
                        <li>ä»å®é™…é—®é¢˜å¼•å…¥ï¼Œæ¿€å‘å­¦ç”Ÿå…´è¶£</li>
                        <li>é€šè¿‡ä¾‹é¢˜è®²è§£ï¼Œå¸®åŠ©å­¦ç”Ÿç†è§£æ ¸å¿ƒæ¦‚å¿µ</li>
                        <li>ç»„ç»‡è¯¾å ‚è®¨è®ºï¼Œä¿ƒè¿›æ·±åº¦æ€è€ƒ</li>
                        <li>å¸ƒç½®ç»ƒä¹ é¢˜ï¼Œå·©å›ºæ‰€å­¦çŸ¥è¯†</li>
                    </ul>
                </div>
            `);
            
            // 5. æ•™å­¦é‡ç‚¹ä¸éš¾ç‚¹
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>äº”ã€æ•™å­¦é‡ç‚¹ä¸éš¾ç‚¹</h4>
                    <p><strong>æ•™å­¦é‡ç‚¹ï¼š</strong></p>
                    <ul>
                        <li>æ ¸å¿ƒæ¦‚å¿µçš„å‡†ç¡®ç†è§£</li>
                        <li>å…¬å¼çš„æ¨å¯¼å’Œåº”ç”¨</li>
                        <li>ä¸å…¶ä»–çŸ¥è¯†ç‚¹çš„è”ç³»</li>
                        <li>å®é™…é—®é¢˜çš„å»ºæ¨¡å’Œæ±‚è§£</li>
                    </ul>
                    <p><strong>æ•™å­¦éš¾ç‚¹ï¼š</strong></p>
                    <ul>
                        <li>æŠ½è±¡æ¦‚å¿µçš„å…·ä½“åŒ–</li>
                        <li>ç†è®ºä¸å®è·µçš„ç»“åˆ</li>
                        <li>æ€ç»´æ–¹æ³•çš„åŸ¹å…»</li>
                    </ul>
                </div>
            `);
            
            // 6. æ•™å­¦æ–¹æ³•ä¸æ‰‹æ®µ
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>å…­ã€æ•™å­¦æ–¹æ³•ä¸æ‰‹æ®µ</h4>
                    <ul>
                        <li><strong>è®²æˆæ³•ï¼š</strong>ç³»ç»Ÿè®²è§£æ ¸å¿ƒæ¦‚å¿µå’ŒåŸç†</li>
                        <li><strong>æ¼”ç¤ºæ³•ï¼š</strong>åˆ©ç”¨çŸ¥è¯†å›¾è°±å±•ç¤ºçŸ¥è¯†å…³è”</li>
                        <li><strong>æ¡ˆä¾‹æ³•ï¼š</strong>é€šè¿‡å®é™…æ¡ˆä¾‹åŠ æ·±ç†è§£</li>
                        <li><strong>è®¨è®ºæ³•ï¼š</strong>ç»„ç»‡å­¦ç”Ÿè®¨è®ºï¼ŒåŸ¹å…»æ€ç»´èƒ½åŠ›</li>
                        <li><strong>ç»ƒä¹ æ³•ï¼š</strong>é€šè¿‡ç»ƒä¹ å·©å›ºçŸ¥è¯†</li>
                    </ul>
                </div>
            `);
            
            // 7. æ•™å­¦è¿‡ç¨‹
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>ä¸ƒã€æ•™å­¦è¿‡ç¨‹</h4>
                    <p><strong>é¢„è®¡å­¦ä¹ æ—¶é—´ï¼š</strong>${node.estimatedStudyTime || '2å°æ—¶'}</p>
                    <p><strong>æ—¶é—´åˆ†é…å»ºè®®ï¼š</strong></p>
                    <ul>
                        <li>å¯¼å…¥ä¸å¤ä¹ ï¼ˆ10åˆ†é’Ÿï¼‰ï¼šå¤ä¹ å‰ç½®çŸ¥è¯†ï¼Œå¼•å…¥æ–°è¯¾</li>
                        <li>æ¦‚å¿µè®²è§£ï¼ˆ30åˆ†é’Ÿï¼‰ï¼šè®²è§£æ ¸å¿ƒæ¦‚å¿µå’Œå…¬å¼</li>
                        <li>ä¾‹é¢˜æ¼”ç¤ºï¼ˆ30åˆ†é’Ÿï¼‰ï¼šé€šè¿‡ä¾‹é¢˜åŠ æ·±ç†è§£</li>
                        <li>ç»ƒä¹ å·©å›ºï¼ˆ30åˆ†é’Ÿï¼‰ï¼šå­¦ç”Ÿç»ƒä¹ ï¼Œæ•™å¸ˆæŒ‡å¯¼</li>
                        <li>æ€»ç»“æå‡ï¼ˆ10åˆ†é’Ÿï¼‰ï¼šæ€»ç»“è¦ç‚¹ï¼Œå¸ƒç½®ä½œä¸š</li>
                    </ul>
                </div>
            `);
            
            // 8. å®é™…åº”ç”¨
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>å…«ã€å®é™…åº”ç”¨</h4>
                    <p>æœ¬çŸ¥è¯†ç‚¹åœ¨ä»¥ä¸‹é¢†åŸŸæœ‰é‡è¦åº”ç”¨ï¼š</p>
                    <ul>
                        <li><strong>å·¥ç¨‹æŠ€æœ¯ï¼š</strong>åœ¨å®é™…å·¥ç¨‹é—®é¢˜ä¸­çš„åº”ç”¨</li>
                        <li><strong>ç§‘å­¦ç ”ç©¶ï¼š</strong>åœ¨ç§‘å­¦ç ”ç©¶ä¸­çš„ä½œç”¨</li>
                        <li><strong>æ—¥å¸¸ç”Ÿæ´»ï¼š</strong>ä¸æ—¥å¸¸ç”Ÿæ´»çš„è”ç³»</li>
                    </ul>
                    <p><strong>æ•™å­¦å»ºè®®ï¼š</strong>é€šè¿‡å…·ä½“æ¡ˆä¾‹å±•ç¤ºçŸ¥è¯†ç‚¹çš„å®é™…ä»·å€¼ï¼Œæé«˜å­¦ç”Ÿå­¦ä¹ åŠ¨æœºã€‚</p>
                </div>
            `);
            
            // 9. è¯¾åä½œä¸š
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>ä¹ã€è¯¾åä½œä¸š</h4>
                    <ul>
                        <li>å¤ä¹ æœ¬èŠ‚è¯¾çš„æ ¸å¿ƒæ¦‚å¿µå’Œå…¬å¼</li>
                        <li>å®Œæˆè¯¾åç»ƒä¹ é¢˜ï¼ˆåŸºç¡€é¢˜5é“ï¼Œæé«˜é¢˜3é“ï¼‰</li>
                        <li>é¢„ä¹ ä¸‹ä¸€èŠ‚è¯¾å†…å®¹</li>
                        <li>æ€è€ƒï¼šæœ¬çŸ¥è¯†ç‚¹åœ¨å®é™…ç”Ÿæ´»ä¸­çš„åº”ç”¨</li>
                    </ul>
                </div>
            `);
            
            // 10. æ•™å­¦åæ€
            sections.push(`
                <div class="lesson-plan-section">
                    <h4>åã€æ•™å­¦åæ€</h4>
                    <p>ï¼ˆè¯¾åå¡«å†™ï¼‰</p>
                    <ul>
                        <li>å­¦ç”Ÿå¯¹æ ¸å¿ƒæ¦‚å¿µçš„æŒæ¡æƒ…å†µ</li>
                        <li>æ•™å­¦æ–¹æ³•çš„æœ‰æ•ˆæ€§</li>
                        <li>å­¦ç”Ÿçš„å‚ä¸åº¦å’Œç§¯ææ€§</li>
                        <li>éœ€è¦æ”¹è¿›çš„åœ°æ–¹</li>
                        <li>ä¸‹æ¬¡è¯¾çš„è°ƒæ•´å»ºè®®</li>
                    </ul>
                </div>
            `);
            
            return sections.join('');
        }
        
        // Export lesson plan
        window.exportLessonPlan = function(nodeId) {
            const node = allNodes.find(n => n.id === nodeId);
            if (!node) return;
            
            // Get prerequisites
            const prerequisites = (node.prerequisites || [])
                .map(id => {
                    const prereq = allNodes.find(n => n.id === id);
                    return prereq ? prereq.name : id;
                });
            
            // Get domains
            const domains = (node.domains || [])
                .map(d => domainMap[d]?.name || d);
            
            // Generate markdown content
            let markdown = `# æ•™æ¡ˆï¼š${node.name}\n\n`;
            markdown += `**è‹±æ–‡åç§°ï¼š** ${node.nameEn || 'æ— '}\n\n`;
            markdown += `**ç”Ÿæˆæ—¶é—´ï¼š** ${new Date().toLocaleString('zh-CN')}\n\n`;
            markdown += `---\n\n`;
            
            // 1. æ•™å­¦ç›®æ ‡
            markdown += `## ä¸€ã€æ•™å­¦ç›®æ ‡\n\n`;
            markdown += `é€šè¿‡æœ¬èŠ‚è¯¾çš„å­¦ä¹ ï¼Œå­¦ç”Ÿåº”èƒ½å¤Ÿï¼š\n\n`;
            markdown += `1. ç†è§£å¹¶æŒæ¡"${node.name}"çš„åŸºæœ¬æ¦‚å¿µå’Œå®šä¹‰\n`;
            markdown += `2. èƒ½å¤Ÿè¿ç”¨ç›¸å…³çŸ¥è¯†è§£å†³å®é™…é—®é¢˜\n`;
            markdown += `3. å»ºç«‹ä¸å…¶ä»–çŸ¥è¯†ç‚¹çš„è”ç³»ï¼Œå½¢æˆç³»ç»ŸåŒ–ç†è§£\n`;
            markdown += `4. åŸ¹å…»æ•°å­¦æ€ç»´å’Œé—®é¢˜è§£å†³èƒ½åŠ›\n\n`;
            markdown += `**éš¾åº¦ç­‰çº§ï¼š** ${node.difficulty || 3}/5 | **é‡è¦æ€§ï¼š** ${node.importance || 3}/5\n\n`;
            
            // 2. çŸ¥è¯†ç‚¹æ¦‚è¿°
            markdown += `## äºŒã€çŸ¥è¯†ç‚¹æ¦‚è¿°\n\n`;
            markdown += `${node.description || 'æš‚æ— æè¿°'}\n\n`;
            markdown += `**æ‰€å±å­¦åŸŸï¼š** ${domains.join('ã€') || 'æ— '}\n\n`;
            if (node.keywords && node.keywords.length > 0) {
                markdown += `**å…³é”®è¯ï¼š** ${node.keywords.join('ã€')}\n\n`;
            }
            
            // 3. å‰ç½®çŸ¥è¯†
            markdown += `## ä¸‰ã€å‰ç½®çŸ¥è¯†\n\n`;
            if (prerequisites.length > 0) {
                markdown += `å­¦ä¹ æœ¬çŸ¥è¯†ç‚¹å‰ï¼Œå­¦ç”Ÿåº”è¯¥å·²ç»æŒæ¡ä»¥ä¸‹å†…å®¹ï¼š\n\n`;
                prerequisites.forEach((name, index) => {
                    markdown += `${index + 1}. ${name}\n`;
                });
                markdown += `\nå»ºè®®åœ¨å­¦ä¹ æœ¬èŠ‚å†…å®¹å‰ï¼Œå…ˆå¤ä¹ ä¸Šè¿°å‰ç½®çŸ¥è¯†ã€‚\n\n`;
            } else {
                markdown += `æœ¬çŸ¥è¯†ç‚¹æ— ç‰¹å®šå‰ç½®è¦æ±‚ï¼Œé€‚åˆåˆå­¦è€…å­¦ä¹ ã€‚\n\n`;
            }
            
            // 4. æ ¸å¿ƒå†…å®¹
            markdown += `## å››ã€æ ¸å¿ƒå†…å®¹\n\n`;
            markdown += `${node.description || 'æš‚æ— æè¿°'}\n\n`;
            if (node.formula) {
                markdown += `**æ ¸å¿ƒå…¬å¼ï¼š**\n\n`;
                markdown += `$$${node.formula}$$\n\n`;
            }
            markdown += `**æ•™å­¦å»ºè®®ï¼š**\n\n`;
            markdown += `1. ä»å®é™…é—®é¢˜å¼•å…¥ï¼Œæ¿€å‘å­¦ç”Ÿå…´è¶£\n`;
            markdown += `2. é€šè¿‡ä¾‹é¢˜è®²è§£ï¼Œå¸®åŠ©å­¦ç”Ÿç†è§£æ ¸å¿ƒæ¦‚å¿µ\n`;
            markdown += `3. ç»„ç»‡è¯¾å ‚è®¨è®ºï¼Œä¿ƒè¿›æ·±åº¦æ€è€ƒ\n`;
            markdown += `4. å¸ƒç½®ç»ƒä¹ é¢˜ï¼Œå·©å›ºæ‰€å­¦çŸ¥è¯†\n\n`;
            
            // 5. æ•™å­¦é‡ç‚¹ä¸éš¾ç‚¹
            markdown += `## äº”ã€æ•™å­¦é‡ç‚¹ä¸éš¾ç‚¹\n\n`;
            markdown += `**æ•™å­¦é‡ç‚¹ï¼š**\n\n`;
            markdown += `1. æ ¸å¿ƒæ¦‚å¿µçš„å‡†ç¡®ç†è§£\n`;
            markdown += `2. å…¬å¼çš„æ¨å¯¼å’Œåº”ç”¨\n`;
            markdown += `3. ä¸å…¶ä»–çŸ¥è¯†ç‚¹çš„è”ç³»\n`;
            markdown += `4. å®é™…é—®é¢˜çš„å»ºæ¨¡å’Œæ±‚è§£\n\n`;
            markdown += `**æ•™å­¦éš¾ç‚¹ï¼š**\n\n`;
            markdown += `1. æŠ½è±¡æ¦‚å¿µçš„å…·ä½“åŒ–\n`;
            markdown += `2. ç†è®ºä¸å®è·µçš„ç»“åˆ\n`;
            markdown += `3. æ€ç»´æ–¹æ³•çš„åŸ¹å…»\n\n`;
            
            // 6. æ•™å­¦æ–¹æ³•ä¸æ‰‹æ®µ
            markdown += `## å…­ã€æ•™å­¦æ–¹æ³•ä¸æ‰‹æ®µ\n\n`;
            markdown += `1. **è®²æˆæ³•ï¼š** ç³»ç»Ÿè®²è§£æ ¸å¿ƒæ¦‚å¿µå’ŒåŸç†\n`;
            markdown += `2. **æ¼”ç¤ºæ³•ï¼š** åˆ©ç”¨çŸ¥è¯†å›¾è°±å±•ç¤ºçŸ¥è¯†å…³è”\n`;
            markdown += `3. **æ¡ˆä¾‹æ³•ï¼š** é€šè¿‡å®é™…æ¡ˆä¾‹åŠ æ·±ç†è§£\n`;
            markdown += `4. **è®¨è®ºæ³•ï¼š** ç»„ç»‡å­¦ç”Ÿè®¨è®ºï¼ŒåŸ¹å…»æ€ç»´èƒ½åŠ›\n`;
            markdown += `5. **ç»ƒä¹ æ³•ï¼š** é€šè¿‡ç»ƒä¹ å·©å›ºçŸ¥è¯†\n\n`;
            
            // 7. æ•™å­¦è¿‡ç¨‹
            markdown += `## ä¸ƒã€æ•™å­¦è¿‡ç¨‹\n\n`;
            markdown += `**é¢„è®¡å­¦ä¹ æ—¶é—´ï¼š** ${node.estimatedStudyTime || '2å°æ—¶'}\n\n`;
            markdown += `**æ—¶é—´åˆ†é…å»ºè®®ï¼š**\n\n`;
            markdown += `1. å¯¼å…¥ä¸å¤ä¹ ï¼ˆ10åˆ†é’Ÿï¼‰ï¼šå¤ä¹ å‰ç½®çŸ¥è¯†ï¼Œå¼•å…¥æ–°è¯¾\n`;
            markdown += `2. æ¦‚å¿µè®²è§£ï¼ˆ30åˆ†é’Ÿï¼‰ï¼šè®²è§£æ ¸å¿ƒæ¦‚å¿µå’Œå…¬å¼\n`;
            markdown += `3. ä¾‹é¢˜æ¼”ç¤ºï¼ˆ30åˆ†é’Ÿï¼‰ï¼šé€šè¿‡ä¾‹é¢˜åŠ æ·±ç†è§£\n`;
            markdown += `4. ç»ƒä¹ å·©å›ºï¼ˆ30åˆ†é’Ÿï¼‰ï¼šå­¦ç”Ÿç»ƒä¹ ï¼Œæ•™å¸ˆæŒ‡å¯¼\n`;
            markdown += `5. æ€»ç»“æå‡ï¼ˆ10åˆ†é’Ÿï¼‰ï¼šæ€»ç»“è¦ç‚¹ï¼Œå¸ƒç½®ä½œä¸š\n\n`;
            
            // 8. å®é™…åº”ç”¨
            markdown += `## å…«ã€å®é™…åº”ç”¨\n\n`;
            markdown += `æœ¬çŸ¥è¯†ç‚¹åœ¨ä»¥ä¸‹é¢†åŸŸæœ‰é‡è¦åº”ç”¨ï¼š\n\n`;
            markdown += `1. **å·¥ç¨‹æŠ€æœ¯ï¼š** åœ¨å®é™…å·¥ç¨‹é—®é¢˜ä¸­çš„åº”ç”¨\n`;
            markdown += `2. **ç§‘å­¦ç ”ç©¶ï¼š** åœ¨ç§‘å­¦ç ”ç©¶ä¸­çš„ä½œç”¨\n`;
            markdown += `3. **æ—¥å¸¸ç”Ÿæ´»ï¼š** ä¸æ—¥å¸¸ç”Ÿæ´»çš„è”ç³»\n\n`;
            markdown += `**æ•™å­¦å»ºè®®ï¼š** é€šè¿‡å…·ä½“æ¡ˆä¾‹å±•ç¤ºçŸ¥è¯†ç‚¹çš„å®é™…ä»·å€¼ï¼Œæé«˜å­¦ç”Ÿå­¦ä¹ åŠ¨æœºã€‚\n\n`;
            
            // 9. è¯¾åä½œä¸š
            markdown += `## ä¹ã€è¯¾åä½œä¸š\n\n`;
            markdown += `1. å¤ä¹ æœ¬èŠ‚è¯¾çš„æ ¸å¿ƒæ¦‚å¿µå’Œå…¬å¼\n`;
            markdown += `2. å®Œæˆè¯¾åç»ƒä¹ é¢˜ï¼ˆåŸºç¡€é¢˜5é“ï¼Œæé«˜é¢˜3é“ï¼‰\n`;
            markdown += `3. é¢„ä¹ ä¸‹ä¸€èŠ‚è¯¾å†…å®¹\n`;
            markdown += `4. æ€è€ƒï¼šæœ¬çŸ¥è¯†ç‚¹åœ¨å®é™…ç”Ÿæ´»ä¸­çš„åº”ç”¨\n\n`;
            
            // 10. æ•™å­¦åæ€
            markdown += `## åã€æ•™å­¦åæ€\n\n`;
            markdown += `ï¼ˆè¯¾åå¡«å†™ï¼‰\n\n`;
            markdown += `1. å­¦ç”Ÿå¯¹æ ¸å¿ƒæ¦‚å¿µçš„æŒæ¡æƒ…å†µ\n`;
            markdown += `2. æ•™å­¦æ–¹æ³•çš„æœ‰æ•ˆæ€§\n`;
            markdown += `3. å­¦ç”Ÿçš„å‚ä¸åº¦å’Œç§¯ææ€§\n`;
            markdown += `4. éœ€è¦æ”¹è¿›çš„åœ°æ–¹\n`;
            markdown += `5. ä¸‹æ¬¡è¯¾çš„è°ƒæ•´å»ºè®®\n\n`;
            
            markdown += `---\n\n`;
            markdown += `**æ•™æ¡ˆç”Ÿæˆå·¥å…·ï¼š** é«˜ç­‰æ•°å­¦å­¦åŸŸçŸ¥è¯†å›¾è°±ç³»ç»Ÿ\n`;
            markdown += `**è”ç³»æ–¹å¼ï¼š** 15805295231\n`;
            
            // Create download
            const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `æ•™æ¡ˆ-${node.name}-${new Date().toISOString().split('T')[0]}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('âœ… æ•™æ¡ˆå·²å¯¼å‡ºä¸º Markdown æ–‡ä»¶');
        };
        
        // Present node (fullscreen)
        window.presentNode = function(nodeId) {
            // Already showing detail, just go fullscreen
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            }
        };
        
        // Bind events
        function bindEvents() {
            // Chapter click
            document.getElementById('chapterList').addEventListener('click', (e) => {
                const item = e.target.closest('.chapter-item');
                if (item) {
                    const chapter = item.dataset.chapter;
                    renderNodesForChapter(chapter);
                }
            });
            
            // Search
            document.getElementById('quickSearch').addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase().trim();
                if (!query) {
                    renderChapterList();
                    return;
                }
                
                // Filter nodes
                const filtered = allNodes.filter(node => 
                    node.name.toLowerCase().includes(query) ||
                    (node.description && node.description.toLowerCase().includes(query)) ||
                    (node.keywords && node.keywords.some(k => k.toLowerCase().includes(query)))
                );
                
                // Render filtered results
                const contentArea = document.getElementById('contentArea');
                contentArea.innerHTML = `
                    <h2 style="margin-bottom: 24px; color: #667eea;">æœç´¢ç»“æœï¼š${filtered.length} ä¸ª</h2>
                    <div class="node-grid">
                        ${filtered.map(node => renderNodeCard(node)).join('')}
                    </div>
                `;
            });
            
            // Fullscreen
            document.getElementById('btnFullscreen').addEventListener('click', () => {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                }
            });
        }
        
        // Show toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Initialize on load
        init();
    </script>
</body>
</html>
