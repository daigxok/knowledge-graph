# æ‰¹é‡æ“ä½œé¢æ¿æ•…éšœæ’æŸ¥æŒ‡å— ğŸ”§

## é—®é¢˜æè¿°
é€‰æ‹©å¤šä¸ªèŠ‚ç‚¹åï¼Œå³ä¸‹è§’æ²¡æœ‰å‡ºç°"æ‰¹é‡æ“ä½œ"é¢æ¿ã€‚

---

## å¯èƒ½çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆ

### 1. æ•™å¸ˆåŠŸèƒ½æœªæ­£ç¡®åˆå§‹åŒ– âš ï¸

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æ‰§è¡Œ
console.log(window.teacherFeatures);
console.log(window.batchOperationManager);
```

**å¦‚æœè¿”å› `undefined`**ï¼š
- æ•™å¸ˆåŠŸèƒ½æ¨¡å—æœªåŠ è½½
- éœ€è¦åœ¨ä¸»åº”ç”¨ä¸­æ­£ç¡®å¯¼å…¥å’Œåˆå§‹åŒ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨ `index.html` çš„ `<script type="module">` éƒ¨åˆ†æ·»åŠ ï¼š

```javascript
import { teacherFeatures } from './js/modules/TeacherFeatures.js';
import { batchOperationManager } from './js/modules/BatchOperationManager.js';

// åˆå§‹åŒ–æ•™å¸ˆåŠŸèƒ½
teacherFeatures.initialize();

// ä½¿å…¶å…¨å±€å¯è®¿é—®ï¼ˆç”¨äºè°ƒè¯•ï¼‰
window.teacherFeatures = teacherFeatures;
window.batchOperationManager = batchOperationManager;
```

---

### 2. å¤‡è¯¾æ¨¡å¼æœªå¼€å¯ âš ï¸

**æ£€æŸ¥æ–¹æ³•**ï¼š
- æŸ¥çœ‹é¡µé¢å³ä¸Šè§’æ˜¯å¦æœ‰"å¤‡è¯¾æ¨¡å¼"å¼€å…³
- å¼€å…³æ˜¯å¦å¤„äºå¼€å¯çŠ¶æ€ï¼ˆç»¿è‰²/æ¿€æ´»ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿ä½¿ç”¨æ•™å¸ˆè´¦å·ç™»å½•
2. ç‚¹å‡»å³ä¸Šè§’çš„"å¤‡è¯¾æ¨¡å¼"å¼€å…³
3. çœ‹åˆ°å³ä¸‹è§’å‡ºç°"â•"æµ®åŠ¨æŒ‰é’®

---

### 3. å¤šé€‰æ¨¡å¼æœªå¯ç”¨ âš ï¸

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
console.log(batchOperationManager.multiSelectEnabled);
```

**å¦‚æœè¿”å› `false` æˆ– `undefined`**ï¼š
- å¤šé€‰æ¨¡å¼æœªå¯ç”¨
- éœ€è¦æ‰‹åŠ¨å¯ç”¨æˆ–é€šè¿‡å¤‡è¯¾æ¨¡å¼è‡ªåŠ¨å¯ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// åœ¨æ§åˆ¶å°æ‰‹åŠ¨å¯ç”¨
batchOperationManager.enableMultiSelectMode();
```

---

### 4. èŠ‚ç‚¹é€‰æ‹©äº‹ä»¶æœªè§¦å‘ âš ï¸

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
console.log(batchOperationManager.selectedNodes);
console.log(batchOperationManager.getSelectedCount());
```

**å¦‚æœé€‰æ‹©èŠ‚ç‚¹åæ•°é‡ä»ä¸º 0**ï¼š
- èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶æœªæ­£ç¡®ç»‘å®š
- äº‹ä»¶ç›‘å¬å™¨æœªè®¾ç½®

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ£€æŸ¥æ˜¯å¦æ­£ç¡®ç›‘å¬äº†èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶ï¼š

```javascript
// åœ¨å›¾è°±æ¸²æŸ“ä»£ç ä¸­æ·»åŠ 
node.on('click', function(e) {
    if (e.event.ctrlKey || e.event.metaKey) {
        // è§¦å‘å¤šé€‰äº‹ä»¶
        window.dispatchEvent(new CustomEvent('nodeClickInMultiSelect', {
            detail: {
                nodeId: this.id(),
                nodeElement: this
            }
        }));
    }
});
```

---

### 5. CSSæ ·å¼æœªåŠ è½½ âš ï¸

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
const panel = document.getElementById('batchOperationPanel');
console.log(panel);
console.log(panel ? getComputedStyle(panel).display : 'Panel not found');
```

**å¦‚æœé¢æ¿å­˜åœ¨ä½†ä¸å¯è§**ï¼š
- CSSæ–‡ä»¶æœªåŠ è½½
- æ ·å¼è¢«è¦†ç›–

**è§£å†³æ–¹æ¡ˆ**ï¼š
ç¡®ä¿åœ¨ HTML ä¸­å¼•å…¥äº†æ‰¹é‡æ“ä½œæ ·å¼ï¼š

```html
<link rel="stylesheet" href="styles/batch-operations.css">
```

---

### 6. é¢æ¿è¢«éšè— âš ï¸

**æ£€æŸ¥æ–¹æ³•**ï¼š
```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
const panel = document.getElementById('batchOperationPanel');
console.log(panel.classList.contains('hidden'));
```

**å¦‚æœè¿”å› `true`**ï¼š
- é¢æ¿å­˜åœ¨ä½†è¢«éšè—
- å¯èƒ½æ˜¯é€‰æ‹©æ•°é‡ä¸º0æˆ–é€»è¾‘é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// æ‰‹åŠ¨æ˜¾ç¤ºé¢æ¿ï¼ˆæµ‹è¯•ç”¨ï¼‰
const panel = document.getElementById('batchOperationPanel');
panel.classList.remove('hidden');
```

---

## å®Œæ•´çš„æ•…éšœæ’æŸ¥æµç¨‹

### æ­¥éª¤1ï¼šæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
```
æŒ‰ F12 æˆ–å³é”® â†’ æ£€æŸ¥
```

### æ­¥éª¤2ï¼šæ£€æŸ¥æ§åˆ¶å°é”™è¯¯
æŸ¥çœ‹æ˜¯å¦æœ‰JavaScripté”™è¯¯ï¼š
- æ¨¡å—åŠ è½½å¤±è´¥
- è¯­æ³•é”™è¯¯
- å¼•ç”¨é”™è¯¯

### æ­¥éª¤3ï¼šéªŒè¯æ¨¡å—åŠ è½½
```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
console.log('TeacherFeatures:', window.teacherFeatures);
console.log('BatchOperationManager:', window.batchOperationManager);
console.log('Panel exists:', !!document.getElementById('batchOperationPanel'));
```

### æ­¥éª¤4ï¼šæ£€æŸ¥å¤‡è¯¾æ¨¡å¼
```javascript
// åœ¨æ§åˆ¶å°æ‰§è¡Œ
console.log('Teaching mode enabled:', teacherFeatures?.teachingModeEnabled);
console.log('Multi-select enabled:', batchOperationManager?.multiSelectEnabled);
```

### æ­¥éª¤5ï¼šæµ‹è¯•èŠ‚ç‚¹é€‰æ‹©
```javascript
// æ‰‹åŠ¨é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæµ‹è¯•ç”¨ï¼‰
batchOperationManager.selectNode('node-d1-test', null);
console.log('Selected count:', batchOperationManager.getSelectedCount());
```

### æ­¥éª¤6ï¼šæ‰‹åŠ¨æ˜¾ç¤ºé¢æ¿
```javascript
// å¦‚æœé¢æ¿å­˜åœ¨ä½†ä¸æ˜¾ç¤º
batchOperationManager.showBatchPanel();
```

---

## å¿«é€Ÿä¿®å¤è„šæœ¬

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹è„šæœ¬è¿›è¡Œå¿«é€Ÿè¯Šæ–­ï¼š

```javascript
// æ‰¹é‡æ“ä½œé¢æ¿è¯Šæ–­è„šæœ¬
(function() {
    console.log('=== æ‰¹é‡æ“ä½œé¢æ¿è¯Šæ–­ ===\n');
    
    // 1. æ£€æŸ¥æ¨¡å—
    console.log('1. æ¨¡å—æ£€æŸ¥:');
    console.log('   TeacherFeatures:', typeof window.teacherFeatures);
    console.log('   BatchOperationManager:', typeof window.batchOperationManager);
    
    // 2. æ£€æŸ¥é¢æ¿å…ƒç´ 
    console.log('\n2. é¢æ¿å…ƒç´ :');
    const panel = document.getElementById('batchOperationPanel');
    console.log('   Panel exists:', !!panel);
    if (panel) {
        console.log('   Panel hidden:', panel.classList.contains('hidden'));
        console.log('   Panel display:', getComputedStyle(panel).display);
    }
    
    // 3. æ£€æŸ¥çŠ¶æ€
    console.log('\n3. çŠ¶æ€æ£€æŸ¥:');
    if (window.batchOperationManager) {
        console.log('   Multi-select enabled:', batchOperationManager.multiSelectEnabled);
        console.log('   Selected nodes:', batchOperationManager.getSelectedCount());
        console.log('   Selected IDs:', Array.from(batchOperationManager.selectedNodes));
    }
    
    // 4. æ£€æŸ¥CSS
    console.log('\n4. CSSæ£€æŸ¥:');
    const cssLoaded = Array.from(document.styleSheets).some(sheet => 
        sheet.href && sheet.href.includes('batch-operations.css')
    );
    console.log('   batch-operations.css loaded:', cssLoaded);
    
    // 5. å»ºè®®
    console.log('\n5. å»ºè®®æ“ä½œ:');
    if (!window.batchOperationManager) {
        console.log('   âŒ éœ€è¦åˆå§‹åŒ– BatchOperationManager');
        console.log('   æ‰§è¡Œ: import { batchOperationManager } from "./js/modules/BatchOperationManager.js"');
    } else if (!panel) {
        console.log('   âŒ éœ€è¦åˆ›å»ºæ‰¹é‡æ“ä½œé¢æ¿');
        console.log('   æ‰§è¡Œ: batchOperationManager.initialize()');
    } else if (panel.classList.contains('hidden')) {
        console.log('   âš ï¸ é¢æ¿è¢«éšè—ï¼Œå¯èƒ½éœ€è¦é€‰æ‹©èŠ‚ç‚¹');
        console.log('   æµ‹è¯•: batchOperationManager.selectNode("test-node", null)');
    } else {
        console.log('   âœ… é¢æ¿åº”è¯¥å¯è§');
    }
    
    console.log('\n=== è¯Šæ–­å®Œæˆ ===');
})();
```

---

## æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1ï¼šåˆå§‹åŒ–æ‰¹é‡æ“ä½œç®¡ç†å™¨
```javascript
// å¦‚æœæœªåˆå§‹åŒ–ï¼Œæ‰‹åŠ¨åˆå§‹åŒ–
if (!document.getElementById('batchOperationPanel')) {
    batchOperationManager.initialize();
    console.log('âœ… æ‰¹é‡æ“ä½œç®¡ç†å™¨å·²åˆå§‹åŒ–');
}
```

### æµ‹è¯•2ï¼šå¯ç”¨å¤šé€‰æ¨¡å¼
```javascript
batchOperationManager.enableMultiSelectMode();
console.log('âœ… å¤šé€‰æ¨¡å¼å·²å¯ç”¨');
```

### æµ‹è¯•3ï¼šæ¨¡æ‹Ÿé€‰æ‹©èŠ‚ç‚¹
```javascript
// é€‰æ‹©ä¸¤ä¸ªæµ‹è¯•èŠ‚ç‚¹
batchOperationManager.selectNode('node-1', null);
batchOperationManager.selectNode('node-2', null);
console.log('âœ… å·²é€‰æ‹©', batchOperationManager.getSelectedCount(), 'ä¸ªèŠ‚ç‚¹');
```

### æµ‹è¯•4ï¼šæ£€æŸ¥é¢æ¿æ˜¾ç¤º
```javascript
const panel = document.getElementById('batchOperationPanel');
console.log('é¢æ¿æ˜¯å¦éšè—:', panel.classList.contains('hidden'));
console.log('é€‰æ‹©æ•°é‡:', document.getElementById('batchSelectedCount').textContent);
```

---

## æ­£ç¡®çš„ä½¿ç”¨æµç¨‹

### 1. ç¡®ä¿æ•™å¸ˆåŠŸèƒ½å·²åŠ è½½
```javascript
// åœ¨ä¸»åº”ç”¨åˆå§‹åŒ–æ—¶
import { teacherFeatures } from './js/modules/TeacherFeatures.js';
teacherFeatures.initialize();
```

### 2. ç™»å½•æ•™å¸ˆè´¦å·
- ä½¿ç”¨æ•™å¸ˆè§’è‰²æ³¨å†Œçš„è´¦å·ç™»å½•
- ç¡®è®¤ç”¨æˆ·è§’è‰²ä¸º "teacher"

### 3. å¼€å¯å¤‡è¯¾æ¨¡å¼
- ç‚¹å‡»å³ä¸Šè§’"å¤‡è¯¾æ¨¡å¼"å¼€å…³
- ç¡®è®¤å¼€å…³å˜ä¸ºæ¿€æ´»çŠ¶æ€

### 4. é€‰æ‹©å¤šä¸ªèŠ‚ç‚¹
- æŒ‰ä½ `Ctrl`ï¼ˆWindowsï¼‰æˆ– `Cmd`ï¼ˆMacï¼‰
- ç‚¹å‡»è¦é€‰æ‹©çš„èŠ‚ç‚¹
- èŠ‚ç‚¹åº”è¯¥é«˜äº®æ˜¾ç¤º

### 5. æŸ¥çœ‹æ‰¹é‡æ“ä½œé¢æ¿
- é¢æ¿åº”è¯¥è‡ªåŠ¨å‡ºç°åœ¨å³ä¸‹è§’
- æ˜¾ç¤ºå·²é€‰æ‹©çš„èŠ‚ç‚¹æ•°é‡
- æä¾›"æ‰¹é‡ç”Ÿæˆæ•™æ¡ˆ"å’Œ"æ¸…é™¤é€‰æ‹©"æŒ‰é’®

---

## å¸¸è§é”™è¯¯ä¿¡æ¯

### é”™è¯¯1: "Cannot read property 'initialize' of undefined"
**åŸå› **: BatchOperationManager æœªæ­£ç¡®å¯¼å…¥  
**è§£å†³**: æ£€æŸ¥ import è¯­å¥å’Œæ¨¡å—è·¯å¾„

### é”™è¯¯2: "batchOperationPanel is null"
**åŸå› **: é¢æ¿æœªåˆ›å»º  
**è§£å†³**: è°ƒç”¨ `batchOperationManager.initialize()`

### é”™è¯¯3: é¢æ¿å­˜åœ¨ä½†ä¸æ˜¾ç¤º
**åŸå› **: CSS ç±» `hidden` æœªç§»é™¤  
**è§£å†³**: ç¡®ä¿é€‰æ‹©äº†è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹

---

## è”ç³»æ”¯æŒ

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ï¼š

1. æµè§ˆå™¨ç±»å‹å’Œç‰ˆæœ¬
2. æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ï¼ˆå®Œæ•´ï¼‰
3. è¯Šæ–­è„šæœ¬çš„è¾“å‡ºç»“æœ
4. æ˜¯å¦ä½¿ç”¨æ•™å¸ˆè´¦å·ç™»å½•
5. å¤‡è¯¾æ¨¡å¼æ˜¯å¦å¼€å¯

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-28  
**é€‚ç”¨ç³»ç»Ÿ**: çŸ¥è¯†å›¾è°±æ•™å¸ˆå¤‡è¯¾ç³»ç»Ÿ
